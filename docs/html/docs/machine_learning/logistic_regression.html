

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Logistic Regression &mdash; Business Analytics 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script type="text/javascript" src="https://unpkg.com/@jupyter-widgets/html-manager@^0.14.0/dist/embed-amd.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"equationNumbers": {"autoNumber": "AMS", "useLabelIds": true}}, "tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://unpkg.com/font-awesome@4.5.0/css/font-awesome.min.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Naive Bayes" href="naive_bayes.html" />
    <link rel="prev" title="Introduction to Machine Learning" href="machine_learning.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Business Analytics
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Business Analytics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../regression_analysis/regression.html">Applied Regression Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../time_series/time_series.html">Time Series Analysis</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="machine_learning.html">Introduction to Machine Learning</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Logistic Regression</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Book-Club">Book Club</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Fitting">Fitting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Validation">Validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="naive_bayes.html">Naive Bayes</a></li>
<li class="toctree-l2"><a class="reference internal" href="example.html">A First Look on Deep Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html">A Short History of AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="status.html">Current Status of Deep Learning</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Business Analytics</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="machine_learning.html">Introduction to Machine Learning</a> &raquo;</li>
        
      <li>Logistic Regression</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/docs/machine_learning/logistic_regression.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">run</span> ../initscript.py
<span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;div id=&quot;popup&quot; style=&quot;padding-bottom:5px; display:none;&quot;&gt;</span>
<span class="s2">    &lt;div&gt;Enter Password:&lt;/div&gt;</span>
<span class="s2">    &lt;input id=&quot;password&quot; type=&quot;password&quot;/&gt;</span>
<span class="s2">    &lt;button onclick=&quot;done()&quot; style=&quot;border-radius: 12px;&quot;&gt;Submit&lt;/button&gt;</span>
<span class="s2">&lt;/div&gt;</span>
<span class="s2">&lt;button onclick=&quot;unlock()&quot; style=&quot;border-radius: 12px;&quot;&gt;Unclock&lt;/button&gt;</span>
<span class="s2">&lt;a href=&quot;#&quot; onclick=&quot;code_toggle(this); return false;&quot;&gt;show code&lt;/a&gt;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<script>
  var password,
      teacher_mode,
      isHtml;

  var class_output,
      class_input,
      class_answer;

  function code_toggle(e) {
    var orig_e = e;
    while (!e.closest(class_output).previousElementSibling.classList.contains(class_input)) {
      e = e.closest(class_output).previousElementSibling;
    }
    var target = e.closest(class_output).previousElementSibling;
    if (target.getAttribute("style") == "" || target.getAttribute("style") == null) {
      target.style.display = "none";
      orig_e.innerHTML = 'show code';
    }
    else {
      target.style.removeProperty("display");
      orig_e.innerHTML = 'hide code';
    }
  }

  function hide_answer(e) {
    var target = e.closest(class_answer).nextElementSibling;
    //e.closest(class_output).previousElementSibling.style.display = "none";
    if (target.getAttribute("style") == "" || target.getAttribute("style") == null) {
      target.style.display = "none";
      e.innerHTML = 'show answer';
    }
    else if (teacher_mode) {
        e.innerHTML = 'hide answer';
        target.style.removeProperty("display");
    }
  }

  function done() {
    document.getElementById("popup").style.display = "none";
    var input = document.getElementById("password").value;
    if (input==password) { teacher_mode=1; alert("Unlocked!");}
    else { teacher_mode=0; alert("Wrong password!");}
  };

  function unlock() {
    document.getElementById("popup").style.display = "block";
  }

  $(document).ready(function() {
    $.ajax({
      type: "GET",
      url: "https://raw.githubusercontent.com/ming-zhao/ming-zhao.github.io/master/data/course.csv",
      dataType: "text",
      success: function(data)
      {
        var items = data.split(',');
        var url = window.location.pathname;
        var filename = url.substring(url.lastIndexOf('/')+1);
        password='123';
        for (var i = 0, len = items.length; i < len; ++i) {
            if (filename.includes(items[i].trim()) && i%2==0 && i<items.length) {
                password=items[i+1].trim();
                break;
            }
        }
        var code_blocks = document.getElementsByClassName('nbinput docutils container');
        if (code_blocks[0]==null) {
            isHtml=0;
            code_blocks = document.getElementsByClassName('input');
            class_output=".output_wrapper";
            class_input="input";
            class_answer='.cell';
        }
        else {
            isHtml=1;
            class_output=".nboutput";
            class_input="nbinput";
            class_answer=".nboutput";
        }

        for (var i = 0, len = code_blocks.length; i < len; ++i) {
          if (
              code_blocks[i].innerHTML.indexOf("toggle") !== -1
              || code_blocks[i].innerHTML.indexOf("button onclick") !== -1
             ) {
            code_blocks[i].style.display = "none";
          }
        }
        for (var i = 0, len = code_blocks.length; i < len; ++i) {
          if (code_blocks[i].innerHTML.indexOf("hide_answer") !== -1) {
            code_blocks[i].style.display = "none";
            if (isHtml) {
              code_blocks[i].nextElementSibling.nextElementSibling.style.display = "none";
            }
            else{
              code_blocks[i].closest(class_answer).nextElementSibling.style.display = "none";
            }
          }
        }
      }
    });
  });
</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div id="popup" style="padding-bottom:5px; display:none;">
    <div>Enter Password:</div>
    <input id="password" type="password"/>
    <button onclick="done()" style="border-radius: 12px;">Submit</button>
</div>
<button onclick="unlock()" style="border-radius: 12px;">Unclock</button>
<a href="#" onclick="code_toggle(this); return false;">show code</a></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">run</span> loadmlfuncs.py

<span class="n">df_book_part1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">dataurl</span><span class="o">+</span><span class="s1">&#39;book_train.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;customer&#39;</span><span class="p">)</span>
<span class="n">df_book_part2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">dataurl</span><span class="o">+</span><span class="s1">&#39;book_validation.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;customer&#39;</span><span class="p">)</span>

<span class="n">toggle</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<a href="#" onclick="code_toggle(this); return false;">show code</a></div>
</div>
<div class="section" id="Logistic-Regression">
<h1>Logistic Regression<a class="headerlink" href="#Logistic-Regression" title="Permalink to this headline">¶</a></h1>
<p>Logistic regression is a popular method for classifying individuals, given the values of a set of explanatory variables. It estimates the probability that an individual is in a particular category.</p>
<div class="section" id="Book-Club">
<h2>Book Club<a class="headerlink" href="#Book-Club" title="Permalink to this headline">¶</a></h2>
<p>A new title, “The Art History of Florence”, is ready for release. A book club has sent promotion mails to a sample of customers from its customer base in two different times. Each time it randomly select 1000 customers.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_book_part1</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>month</th>
      <th>art_book</th>
      <th>purchased</th>
    </tr>
    <tr>
      <th>customer</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>24</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>16</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>15</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>22</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>15</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_book_part2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>month</th>
      <th>art_book</th>
      <th>purchased</th>
    </tr>
    <tr>
      <th>customer</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1001</th>
      <td>30</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1002</th>
      <td>12</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1003</th>
      <td>18</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1004</th>
      <td>27</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1005</th>
      <td>4</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Book club has collected data several variables for all 2000 customers as follows:</p>
<ul class="simple">
<li><p>month: months to the customer’s last purchase when promotion mail is sent</p></li>
<li><p>art_book: number of art books the customer purchased before</p></li>
<li><p>purchased: if s/he paid for the new title “The Art History of Florence”</p></li>
</ul>
<p>It costs the book club $1 for sending a mail and generates $7 profit for selling the book. After two promotions, an analyst in the book club realize that it actually lost money in both promotions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">calc_profit</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">mail_cost</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">selling_profit</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">profit</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">purchased</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="mi">7</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">*</span><span class="n">mail_cost</span>
    <span class="k">return</span> <span class="n">profit</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;net profit for the 1st promotion:&#39;</span><span class="p">,</span> <span class="n">calc_profit</span><span class="p">(</span><span class="n">df_book_part1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;net profit for the 2nd promotion:&#39;</span><span class="p">,</span> <span class="n">calc_profit</span><span class="p">(</span><span class="n">df_book_part2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
net profit for the 1st promotion: -418
net profit for the 2nd promotion: -433
</pre></div></div>
</div>
<p>The analyst believes that the book club should build a predictive model to predict a customer’s probability of purchasing, and then send out promotion mail only if such a probability is high enough.</p>
<ul class="simple">
<li><p>can we derive a prediction model after collecting the data from the first promotion?</p></li>
<li><p>can this prediction model improve the second promotion?</p></li>
</ul>
<p>We expect this prediction model</p>
<ul class="simple">
<li><p>uses <code class="docutils literal notranslate"><span class="pre">month</span></code> and <code class="docutils literal notranslate"><span class="pre">art_book</span></code> to predict <code class="docutils literal notranslate"><span class="pre">purchased</span></code></p></li>
</ul>
<p>A regression equation <code class="docutils literal notranslate"><span class="pre">purchased</span></code> <span class="math notranslate nohighlight">\(\sim\)</span> <code class="docutils literal notranslate"><span class="pre">month</span></code> <span class="math notranslate nohighlight">\(+\)</span> <code class="docutils literal notranslate"><span class="pre">art_book</span></code> sounds possible. However, the <span class="math notranslate nohighlight">\(y\)</span> variable <code class="docutils literal notranslate"><span class="pre">purchased</span></code> is either 0 or 1, and a scatter plot between <code class="docutils literal notranslate"><span class="pre">purchased</span></code> and <code class="docutils literal notranslate"><span class="pre">month</span></code> (<span class="math notranslate nohighlight">\(y\)</span> vs <span class="math notranslate nohighlight">\(x\)</span>) shows as follows</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_book_part1</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;purchased&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/docs_machine_learning_logistic_regression_9_0.png" src="../../_images/docs_machine_learning_logistic_regression_9_0.png" />
</div>
</div>
<p>The graph is again many linear regression assumptions:</p>
<ul class="simple">
<li><p>there is no linear relationship between independent and dependent variables</p></li>
<li><p>error term is not going to be normally distributed</p></li>
</ul>
</div>
<div class="section" id="Fitting">
<h2>Fitting<a class="headerlink" href="#Fitting" title="Permalink to this headline">¶</a></h2>
<p>Instead of using binary (purchased or not) as dependent variable, we predict its probability <span class="math notranslate nohighlight">\(p\)</span>, which is now continuous.</p>
<p>We still cannot run a linear regression on <span class="math notranslate nohighlight">\(p\)</span> because it is bounded in range <span class="math notranslate nohighlight">\([0,1]\)</span>. In linear regression, we also need dependent variable to be in range <span class="math notranslate nohighlight">\([-\infty, +\infty]\)</span>.</p>
<p>We introduce <strong>odds</strong> and <strong>utility</strong></p>
<p><span class="math">\begin{align}
\text{odds} &= \frac{p}{1-p} \nonumber \\
\text{utility} &= \log(\text{odds}) \nonumber \\
\end{align}</span></p>
<p>Note that <strong>utility</strong> is in <span class="math notranslate nohighlight">\([-\infty, +\infty]\)</span>. Now a regression equation can be used</p>
<p><span class="math">\begin{align}
\text{utility} &= \beta_0 + \beta_1 \times \text{month} + \beta_2 \times \text{art_book}
\end{align}</span></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">odds</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span>
<span class="n">utility</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">odds</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">odds</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$p$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;odds&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">utility</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$p$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;utility&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/docs_machine_learning_logistic_regression_12_0.png" src="../../_images/docs_machine_learning_logistic_regression_12_0.png" />
</div>
</div>
<p>In practice, we can simply use a typical type of regression, logistic regression, with binary variable as dependent variable. Statistical tools will perform all the transformation for us. In python, we can use either <code class="docutils literal notranslate"><span class="pre">statmodels</span></code> which provides statistical summary or <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> package.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">statsmodels.api</span> <span class="k">import</span> <span class="n">add_constant</span>
<span class="kn">from</span> <span class="nn">statsmodels.formula.api</span> <span class="k">import</span> <span class="n">Logit</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">add_constant</span><span class="p">(</span><span class="n">df_book_part1</span><span class="p">[[</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="s1">&#39;art_book&#39;</span><span class="p">]])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_book_part1</span><span class="p">[</span><span class="s1">&#39;purchased&#39;</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Logit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Optimization terminated successfully.
         Current function value: 0.251705
         Iterations 7
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table class="simpletable">
<caption>Logit Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>     <td>purchased</td>    <th>  No. Observations:  </th>  <td>   999</td>
</tr>
<tr>
  <th>Model:</th>               <td>Logit</td>      <th>  Df Residuals:      </th>  <td>   996</td>
</tr>
<tr>
  <th>Method:</th>               <td>MLE</td>       <th>  Df Model:          </th>  <td>     2</td>
</tr>
<tr>
  <th>Date:</th>          <td>Mon, 01 Jul 2019</td> <th>  Pseudo R-squ.:     </th>  <td>0.1206</td>
</tr>
<tr>
  <th>Time:</th>              <td>18:35:28</td>     <th>  Log-Likelihood:    </th> <td> -251.45</td>
</tr>
<tr>
  <th>converged:</th>           <td>True</td>       <th>  LL-Null:           </th> <td> -285.95</td>
</tr>
<tr>
  <th> </th>                      <td> </td>        <th>  LLR p-value:       </th> <td>1.044e-15</td>
</tr>
</table>
<table class="simpletable">
<tr>
      <td></td>        <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>
</tr>
<tr>
  <th>const</th>    <td>   -2.2262</td> <td>    0.239</td> <td>   -9.316</td> <td> 0.000</td> <td>   -2.695</td> <td>   -1.758</td>
</tr>
<tr>
  <th>month</th>    <td>   -0.0706</td> <td>    0.019</td> <td>   -3.670</td> <td> 0.000</td> <td>   -0.108</td> <td>   -0.033</td>
</tr>
<tr>
  <th>art_book</th> <td>    0.9888</td> <td>    0.135</td> <td>    7.343</td> <td> 0.000</td> <td>    0.725</td> <td>    1.253</td>
</tr>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="k">import</span> <span class="n">linear_model</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_book_part1</span><span class="p">[[</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="s1">&#39;art_book&#39;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_book_part1</span><span class="p">[</span><span class="s1">&#39;purchased&#39;</span><span class="p">]</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;intercept=&#39;</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">coefficient =&#39;</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
intercept= [-2.22621349]
coefficient = [[-0.07061966  0.98880806]]
</pre></div></div>
</div>
</div>
<div class="section" id="Validation">
<h2>Validation<a class="headerlink" href="#Validation" title="Permalink to this headline">¶</a></h2>
<p>After we have obtained <span class="math notranslate nohighlight">\(\beta_0, \beta_1\)</span> and <span class="math notranslate nohighlight">\(\beta_2\)</span>, we can use equation <span class="math notranslate nohighlight">\((1)\)</span> for our validation data to evaluate utility. Then, the probability is derived</p>
<p><span class="math">\begin{align}
p = \frac{\exp(\text{utility})}{1+\exp(\text{utility})} \nonumber
\end{align}</span></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">utility</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">utility</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">utility</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">utility</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;utility&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$p$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/docs_machine_learning_logistic_regression_17_0.png" src="../../_images/docs_machine_learning_logistic_regression_17_0.png" />
</div>
</div>
<p>Generally, our decision can be made based on a threshold value 0.5. If the probability that a customer may purchase the book is greater than 0.5, we send a mail.</p>
<p>However, in the book club case, it has a simple breakeven point which is cost over profit <span class="math notranslate nohighlight">\(1/7\)</span>. So, our decision is that if the probability that a customer may purchase the book is greater than 1/7, we send a mail, otherwise we do not.</p>
<p>We prefer to use <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> because it provides capability to predict the probability directly.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_book_part2</span><span class="p">[</span><span class="s1">&#39;purchase_prob&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">df_book_part2</span><span class="p">[[</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="s1">&#39;art_book&#39;</span><span class="p">]])[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">df_book_part2</span><span class="p">[</span><span class="s1">&#39;send&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_book_part2</span><span class="p">[</span><span class="s1">&#39;purchase_prob&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">7</span>
<span class="n">df_book_part2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>month</th>
      <th>art_book</th>
      <th>purchased</th>
      <th>purchase_prob</th>
      <th>send</th>
    </tr>
    <tr>
      <th>customer</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1001</th>
      <td>30</td>
      <td>0</td>
      <td>0</td>
      <td>0.012808</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1002</th>
      <td>12</td>
      <td>0</td>
      <td>0</td>
      <td>0.044207</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1003</th>
      <td>18</td>
      <td>0</td>
      <td>0</td>
      <td>0.029387</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1004</th>
      <td>27</td>
      <td>1</td>
      <td>0</td>
      <td>0.041323</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1005</th>
      <td>4</td>
      <td>1</td>
      <td>0</td>
      <td>0.179479</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">num_mail_send</span> <span class="o">=</span> <span class="n">df_book_part2</span><span class="p">[</span><span class="n">df_book_part2</span><span class="p">[</span><span class="s1">&#39;send&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">num_purchased</span> <span class="o">=</span> <span class="n">df_book_part2</span><span class="p">[</span><span class="n">df_book_part2</span><span class="p">[</span><span class="s1">&#39;send&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df_book_part2</span><span class="p">[</span><span class="s1">&#39;purchased&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">profit</span> <span class="o">=</span> <span class="n">num_purchased</span> <span class="o">*</span> <span class="mi">7</span> <span class="o">-</span> <span class="n">num_mail_send</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Based on our prediction model, we should send </span><span class="si">{}</span><span class="s1"> mails.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_mail_send</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;We would expect receiving </span><span class="si">{}</span><span class="s1"> orders and profit is $</span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_purchased</span><span class="p">,</span> <span class="n">profit</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Based on our prediction model, we should send 128 mails.
We would expect receiving 38 orders and profit is $138.
</pre></div></div>
</div>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="naive_bayes.html" class="btn btn-neutral float-right" title="Naive Bayes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="machine_learning.html" class="btn btn-neutral float-left" title="Introduction to Machine Learning" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Ming Zhao

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>